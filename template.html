<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>工作日志模板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .btn-fix {
            -webkit-appearance: none;
            appearance: none;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40">
        <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-semibold text-gray-800">工作日志</h1>
            <div id="userInfo" class="hidden flex items-center space-x-4">
                <span id="username" class="text-gray-500 text-sm"></span>
                <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm btn-fix">
                    退出登录
                </button>
            </div>
            <button id="loginBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm btn-fix">
                登录
            </button>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="max-w-4xl mx-auto px-4 py-6">
        <div id="appContent">
            <!-- 您的内容将在这里显示 -->
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="mt-12 pt-8 border-t border-gray-200 text-center text-xs text-gray-400">
        <p>数据存储于 LeanCloud | 页面构建于 Github.io</p>
    </footer>

    <!-- 登录弹窗 -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800">登录</h2>
                <button id="closeModal" class="text-gray-400 hover:text-gray-600 text-2xl btn-fix">&times;</button>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                    <input type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                    <input type="password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm" required>
                </div>
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg text-sm font-medium btn-fix">
                    登录
                </button>
            </form>
        </div>
    </div>

    <!-- LeanCloud SDK 和配置 -->
    <script src="https://unpkg.com/leancloud-storage@4.15.2/dist/av-min.js"></script>
    <script src="config.js"></script>
    <script>
        // 检查配置是否加载成功
        if (typeof LEANCLOUD_CONFIG === 'undefined') {
            throw new Error('配置加载失败，请检查config.js文件');
        }
        
        // 初始化LeanCloud
        try {
            AV.init({
                appId: LEANCLOUD_CONFIG.APP_ID,
                appKey: LEANCLOUD_CONFIG.APP_KEY,
                serverURL: LEANCLOUD_CONFIG.SERVER_URL
            });
            console.log('LeanCloud初始化成功');
        } catch (error) {
            console.error('LeanCloud初始化失败:', error);
            alert('系统初始化失败，请刷新页面重试');
        }

        // 登录弹窗交互
        document.getElementById('loginBtn').addEventListener('click', () => {
            document.getElementById('loginModal').classList.remove('hidden');
        });
        
        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('loginModal').classList.add('hidden');
        });

        // 登录表单提交
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.querySelector('#loginForm input[type="text"]').value;
            const password = document.querySelector('#loginForm input[type="password"]').value;
            
            try {
                const user = await AV.User.logIn(username, password);
                updateLoginState(user);
                document.getElementById('loginModal').classList.add('hidden');
                alert('登录成功');
            } catch (error) {
                console.error('登录失败:', error);
                alert('登录失败: ' + error.message);
            }
        });

        // 登出功能
        document.getElementById('logoutBtn').addEventListener('click', () => {
            AV.User.logOut();
            updateLoginState(null);
            alert('已退出登录');
        });

        // 更新登录状态
        function updateLoginState(user) {
            if (user) {
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('username').textContent = user.getUsername();
            } else {
                document.getElementById('loginBtn').classList.remove('hidden');
                document.getElementById('userInfo').classList.add('hidden');
            }
        }

        // 初始化检查登录状态
        document.addEventListener('DOMContentLoaded', () => {
            const currentUser = AV.User.current();
            updateLoginState(currentUser);
            
            // 添加加载状态
            const loginBtn = document.getElementById('loginBtn');
            const originalText = loginBtn.textContent;
            
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const username = document.querySelector('#loginForm input[type="text"]').value;
                const password = document.querySelector('#loginForm input[type="password"]').value;
                
                try {
                    loginBtn.disabled = true;
                    loginBtn.textContent = '登录中...';
                    
                    const user = await AV.User.logIn(username, password);
                    updateLoginState(user);
                    document.getElementById('loginModal').classList.add('hidden');
                } catch (error) {
                    console.error('登录失败:', error);
                    alert('登录失败: ' + error.message);
                } finally {
                    loginBtn.disabled = false;
                    loginBtn.textContent = originalText;
                }
            });
        });
    </script>
</body>
</html>